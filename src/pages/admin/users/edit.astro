---
import AdminLayout from "@/layouts/AdminLayout.astro";
import UserForm from "@/components/forms/UserForm.astro";
import Breadcrumb from "@/components/ui/Breadcrumb.astro";
import { db } from "@/lib/db";
import { Card } from "@/components/ui/shadcn/card";
const id = Astro.url.searchParams.get("id");

if (!id) {
  return Astro.redirect("/admin/users");
}

let user;

try {
  user = await db
    .selectFrom("user")
    .selectAll()
    .where("id", "=", id)
    .executeTakeFirst();
} catch (error) {
  console.error("Error fetching user:", error);
}

if (!user) {
  return new Response(null, {
    status: 404,
  });
}
---

<AdminLayout title={`${user?.email} | Edit User`}>
  <div class="w-full">
    <Breadcrumb items={[
      {
        href: "/admin",
        label: "Dashboard",
      },
      {
        href: "/admin/users",
        label: "Users",
      },
      {
        href: "",
        label: `Edit: ${user?.first_name || user?.last_name
        ? `${user?.first_name || ""} ${user?.last_name || ""}`.trim()
        : user?.email || ""}`,
      }
    ]} />
    <Card className="p-6">
      <UserForm user={user} redirect="/admin/users" />
    </Card>
  </div>
</AdminLayout>
