---
interface Column {
  align?: "left" | "right" | "center";
  header: string;
  cell: {
    class?: string;
    content: (item: any) => string | Promise<string>;
  };
}

interface Props {
  data: any[] | { error: string };
  columns: Column[];
  title?: string;
  buttonLinks?: {
    href: string;
    text: string;
  }[];
}

import { DataTable } from "@/components/ui/admin/DataTable.tsx";

const { data, columns, title, buttonLinks } = Astro.props;

// Process async content if needed - pre-process all cell content
let processedData = data;
if (data && !('error' in data) && Array.isArray(data)) {
  processedData = await Promise.all(
    data.map(async (item) => {
      const processedItem = { ...item };
      // Pre-process any async cell content and store it
      for (const column of columns) {
        const content = column.cell.content(item);
        const processedContent = content instanceof Promise ? await content : content;
        processedItem[`_cell_${column.header}`] = processedContent;
      }
      return processedItem;
    })
  );
}
---

<DataTable 
  client:load
  data={processedData}
  columns={columns}
  title={title}
  buttonLinks={buttonLinks}
/>
